# Vicoo 启动指南

本文档说明如何启动 Vicoo 的各个服务组件。

## 端口约定

| 服务 | 端口 | 说明 |
|------|------|------|
| 后端 API | 8000 | Express API |
| Web 前端 | 3001 | 固定为 3001，避免与 Claude Code (3000) 冲突 |
| Claude Code | 3000 | 如运行则占用 3000 端口 |

## 启动命令

### 1. 后端 API 服务

```bash
cd D:\PROJECT\vicoo
cd apps\api
pnpm dev
```

- **端口**: 8000
- **访问地址**: http://localhost:8000
- **API 文档**: http://localhost:8000/openapi.json

### 2. Web 前端

```bash
cd D:\PROJECT\vicoo
pnpm dev:web
```

- **端口**: 3001 (固定配置在 `apps/web/vite.config.ts`)
- **访问地址**: http://localhost:3001

### 3. 桌面端 (Tauri)

```bash
cd D:\PROJECT\vicoo
pnpm dev:desktop
```

或者使用脚本：
```bash
.\run-tauri-dev.bat
```

### 4. 移动端 (React Native)

```bash
cd D:\PROJECT\vicoo\apps\mobile
pnpm start
```

## 常用操作

### 重启服务

```bash
# 终止所有 node 进程
taskkill /F /IM node.exe

# 重新启动后端
cd D:\PROJECT\vicoo\apps\api
pnpm dev

# 重新启动前端 (新终端)
cd D:\PROJECT\vicoo
pnpm dev:web
```

### 检查端口占用

```bash
# 检查后端端口
netstat -ano | findstr "LISTENING" | findstr ":8000 "

# 检查前端端口
netstat -ano | findstr "LISTENING" | findstr ":3001 "

# 检查 Claude Code
netstat -ano | findstr "LISTENING" | findstr ":3000 "
```

### Claude Code 健康检查

```bash
curl http://localhost:8000/api/claude/health
```

## 故障排除

### CORS 错误

如果遇到 CORS 错误，请检查 `apps/api/src/index.ts` 中的 CORS 配置。

### spawn ENOENT 错误

如果遇到 `spawn cmd.exe ENOENT` 错误，检查 Claude Code 是否正确安装。

### 前端端口冲突

前端端口固定为 **3001**，不会变化。如果 3001 被占用，修改 `apps/web/vite.config.ts` 中的端口号。

## 项目结构

```
D:\PROJECT\vicoo\
├── apps\
│   ├── api\          # 后端 Express API (端口 8000)
│   ├── web\         # React 前端 (端口 3001)
│   ├── desktop\     # Tauri 桌面端
│   └── mobile\      # React Native 移动端
├── packages\        # 共享包
│   ├── ui\          # UI 组件库
│   ├── types\       # TypeScript 类型
│   └── ...
└── 启动指南.md       # 本文档
```

## 开发注意事项

1. **前端端口固定为 3001** - 这是为了避免与 Claude Code (如果运行在 3000) 冲突
2. **后端代理配置** - Vite 配置了代理，将 `/api` 和 `/health` 请求转发到后端 8000 端口
3. **先启动后端，再启动前端** - 确保 API 服务可用
